
{% extends "base.html" %}
{% block content %}
{% load static %}
{% load app_filters %}

<section>
  <div class="row align-items-start">
    {% getcountries countries as countries %}
    {% include 'projectsidemenu.html' %} 
  <div class="col-md-8 p-0  create-pg main-section col-md-10"> 
    <div class="create_project_sec scroll-line new-cru-well">
      {% comment %} <div class="well-name-list">{{well.name}}</div>
      <button class="hide-show fa fa-long-arrow-right"></button> {% endcomment %}
      {% include "projectheader.html" %}
    <div class="col-12">
        {% include "welldetails_menu.html" %} 
    </div>
    <div class="col-12">
        <div class="sample-sub-menu">
          <div class="container">
          <div class="row menu-button menu-types">
            <!-- <div class="col-md-2"></div> -->
            <div class="col-md-3">
                <div class="sub-list {% if request.session.submenu == 'muddata' %}active{% endif %}">
                    <a href="{% url 'muddata:muddatarheogramlist' wellphase_id %}" id="mud"> Mud Data </a>
                </div>
            </div>
            <!-- <div class="col-md-3">
                <div class="sub-list {% if request.session.submenu == 'rheogram' %}active{% endif %}">
                    <a href="{% url 'muddata:rheogramlist' wellphase_id %}" id="Rheogram">Rheogram</a>
                </div>
            </div> -->
            <div class="col-md-3 data-drill">
                <div class="sub-list drill-data {% if request.session.submenu == 'drillbit' %}active{% endif %}">
                    <a href="{% url 'drillbitdata:drillbitlist' wellphase_id %}" id="drillbit"> Drill Bit Data</a>
                </div>
            </div>
            <div class="col-md-3">
                <div class="sub-list {% if request.session.submenu == 'bhadata' %}active{% endif %}">
                    <a href="{% url 'bhadata:bhadatalist' wellphase_id %}" id="bhadata"> BHA Data</a>
                </div>
            </div>
            <div class="col-md-3 data-drill">
              <div class="sub-list drill-data2  {% if request.session.submenu == 'hydraulics' %}active{% endif %}">
              <a href="{% url 'muddata:calculateallpressureloss' wellphase_id %}" id="bhadata"> Hydraulics</a>
            </div>
          </div>
            
          </div>
          </div>
        </div>
    </div>
    
    
      <!-- <div class="col-2">
        {% for wellphase in wellphases %}
          <div class="row">
            <div class="col-12">
              <a href="{% url 'muddata:getwellphasemenubyid' wellphase.id %}"> {{wellphase.phase_name}}</a>
            </div>
          </div>
        {% endfor %}
      </div> -->
      
        <div class="col-12">
          <!-- <div class="sample-sub-menu">
            <div class="row">
                <div class="col-md-3">
                  <div class="sub-list active">
                        <a href="{% url 'muddata:list' wellphase_id %}" id="mud"> Mud Data </a>
                        </div>
                </div>
                <div class="col-md-3">
                  <div class="sub-list">
                        <a href="{% url 'muddata:rheogramlist' wellphase_id %}" id="Rheogram">Rheogram</a>
                        </div>
                </div>
                <div class="col-md-3">
                  <div class="sub-list">
                        <a href="{% url 'drillbitdata:drillbitlist' wellphase_id %}" id="drillbit"> Drill Bit Data</a>
                        </div>
                </div>
                <div class="col-md-3">
                  <div class="sub-list">
                        <a href="{% url 'bhadata:bhadatalist' wellphase_id %}" id="bhadata"> BHA Data</a>
                        </div>
                </div>
            </div>
            </div> -->
            <div>
              <div class="card bx-shadow scroll-line">
                <div class="card-header">
                  <h4 class="card-title">Edit Drill Bit Data </h4>
                </div>
                <div class="card-body">
                  <form class="form form-horizontal" method="POST">
                      {% csrf_token %}
                      <input type="hidden" id="id_well" class="form-control" name="well" placeholder="Rating" value="{{form.well.value}}" >                    
                      <input type="hidden" id="project_unit" class="form-control" name="unit" value={{unit}}>
                    <div class="row">
                      <!-- <div class="col-12">
                        <div class="form-group row">
                          <div class="col-sm-3 col-form-label">
                            <label for="well_phases">WellPhases</label>
                          </div>
                          <div class="col-sm-9">
                            <select class="form-control" id="well_phases" name="well_phases">
                              <option value="">--  Well Phases --</option>
                              {% for wellphases in wellphase %}                           
                                <option value="{{ wellphases.id }}" {% if wellphases.id == form.well_phases.value %} selected {% endif %}>{{ wellphases.phase_name }}</option>
                              {% endfor %}
                            </select>
                          </div>
                        </div>
                    </div> -->
      
      
                      {%if welltype == 'ACTUAL' %}
                      <div class="col-12">
                          <div class="form-group row">
                            <div class="col-sm-3 col-form-label">
                              <label for="date">Data</label>
                            </div>
                            <div class="col-sm-9">
                              <input type="text" id="basicDate" class="form-control flatpickr-basic flatpickr-input active" name="date"  placeholder="Date" value="{{form.date.value|date:'Y-m-d'}}">
                          </div>
                          </div>
                        </div>
                        {%endif%}
                      <div class="col-12">
                          <div class="form-group row">
                            <div class="col-sm-3 col-form-label">
                              <label for="bit_type">Bit type</label>
                            </div>
                            <div class="col-sm-9">
                              <select class="form-control" id="bit_type" name="bit_type">
                                  <option value="">-- Bit type --</option>
                                  {% for bit_type in bit_types %}
                                
                                  <option value="{{bit_type.id}}" {%if bit_type.id == form.bit_type.value %} selected {% endif %}>{{bit_type.bittype_names}}</option>
                                  {% endfor %}
                                </select>    
                                <span class="bittype_error"></span>               
                            </div>
                          </div>
                        </div>
                        <div class="col-12">
                          <div class="form-group row">
                            <div class="col-sm-3 col-form-label">
                              <label for="well_phases">Manufacturer</label>
                            </div>
                            
                            <div class="col-sm-9">
                              <input type="text" id="manufacture" class="form-control" name="manufacture" value="{{ form.manufacture.value}}">
                              <span class="manufacture_error"></span>
                            </div>
                        </div>
                      </div>
                        <div class="col-12">
                          <div class="form-group row">
                            <div class="col-sm-3 col-form-label">
                              <label for="well_phases">Enter Total Number of Nozzles</label>
                            </div>
                            
                            <div class="col-sm-9">
                              <input type="number" id="no_of_nozzle" class="form-control no_of_nozzle" name="no_of_nozzle" value="{{ form.no_of_nozzle.value}}">
                              <span class="nozzle_error"></span>
                            </div>
                        </div>
                        <div class="form-group row">
                          <div class="col-sm-3 col-form-label">
                            <label class="project-edit-name" for="well_phases">Extended Nozzle</label>
                          </div>
                          <!-- <div class="col-sm-3"> -->
                            <input type="checkbox" id="external_nozzle" name="external_nozzle" style="margin-top: 14px; margin: 15px;" value="1" {% if True == form.external_nozzle.value %} checked {%endif%} >
                            <span class="external_nozzle_error"></span>
                            <!-- </div> -->
                        </div>
                      </div>
                        <div class="col-12">
                          <table class="table" id="drillbittable">
                              <h4 class="card-title text-center">Nozzle Configuration</caption>
                              <tr><th>Nozzles Size {%display_nozzle_size_unit request.session.unit%}</th></tr>
                              {% for nozzle in drillbitnozzle %}
                              {% if nozzle.nozzle_size != None%}
                              <tr id="drillbitrow">
                              
                                
                                <!-- <td><input type="number" step="any" class="form-control" name="no_of_nozzle" placeholder="Number of Nozzle" value="{{ nozzle.no_of_nozzle}}"></td> -->
                                <td><input type="number" step="any" class="form-control nozzle_size" name="nozzle_size" placeholder="Nozzle Size" value="{{nozzle.nozzle_size}}"><span class="nozzle_size_error"></span></td>
                                <!-- <td>
                                  <button type="button" name="add" value="Add" class="drillbitadd iconaction"><i class="fa fa-plus"></i></button>
                                  <button type="button" name="removerow" value="Remove" class="drillbitremove iconaction"><i class="fa fa-trash"></i></button>
                                </td>   -->
                              </tr>
                            {%endif%}
                              {% endfor %}
                          </table>
                          <div class="form-group row">
                            <div class="col-sm-1 col-form-label">
                              <label for="well_phases">TFA ({%display_tfa_unit request.session.unit%})</label>
                            </div>
                            
                            <div class="col-sm-11" id="total">
                              <input type="text" id="tfa" oninput="validate(this)" class="form-control" placeholder="TFA" name="tfa" value="{{form.tfa.value}}" readonly>
                            </div>
                        </div>
                      </div>
      
                      <!-- <div class="col-12">
                        </div> -->
                        <div class="col-sm-9 offset-sm-3">
                        <button type="submit" class="btn btn-primary mr-1 waves-effect waves-float waves-light detail-button drillbit_submit">Submit</button>
                        <!-- <button type="reset" class="btn btn-outline-secondary waves-effect">Reset</button> -->
                        <a class="btn btn-primary pull-right detail-button" href="{{request.META.HTTP_REFERER}}">Go Back</a>
                      </div>
      
      
                    </div>
                  </form>
                </div>
              </div>
        </div>
    </div>
    {% include "footer.html" %}
    </div>
   
    </div>
    <div class="col-2">
      {% comment %} {% include "userheader.html" %} {% endcomment %}
      <h4 class="model-caption">Well Phases</h4>
      {% for wellphase in wellphases %}
      <div class="row">
        <div class="col-12">
          <nav class="navbar bg-white phase-sidemenu">
            <ul class="nav navbar-nav">
              <li class="nav-item phs-list {% if request.session.wellphasetab == wellphase.id %}active{% endif %}">
                <a class="nav-link" href="{% url 'muddata:getwellphasemenubyid' wellphase.id %}"> {{wellphase.phase_name}}</a>
                <ul class="myDIV nav navbar-nav custom_active_list pressure-sidemenu  {% if wellphase_id == wellphase.id %}show{% endif %}">
                  {% getsectionbywellphase_id wellphase.id as sections %}
                  {% for section in sections %}
                  <li data-id="{{section.section_name}}" wellphase_id="{{wellphase.id}}" class="wellphase_sidemenu remove-line">{{section.section_name | depthunit:request.session.unit}}</li>
                  {% endfor %}
              </ul>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      {% endfor %}
      <div class="col-md-12 warning"></div>
    </div>
    </div>
</section>
<script src="{% static 'vendors/js/vendors.min.js' %}"></script>
<script src="{% static 'vendors/js/forms/validation/jquery.validate.min.js' %}"></script>
<script>
  $(document.body).on("blur", ".no_of_nozzle" , function() {
    var a;
      a = document.getElementById('no_of_nozzle').value;
      var rowCounts = $('#drillbittable >tbody >tr').length;
      var unit = document.getElementById('project_unit').value;
      var uppendrow= a-(rowCounts-1)
      var rows = "";
      if(uppendrow >=0){
        for (var i = 0; i < uppendrow; i++) {
          var n=i+1;
          rows += '<tr><td> <input type="number" step="any" id="nozzle_size" class="form-control nozzle_size" name="nozzle_size"><span class="nozzle_size_error"></span></td></tr>';
        }
        $("#drillbittable").append(rows);
      }
      else{
        for (var i = uppendrow; i <0; i++) {
          $("#drillbittable tr:last").remove();
        }
      }
      var max=[];
      var values = 0;
      $(".nozzle_size").each(function(){
        values += parseFloat(Math.pow($(this).val(),2));
      });
      if (unit == 'API'){
      var property_value = Math.PI/4096*(values)
      $("#tfa").val(property_value.toFixed(2));
    }
    else{
      var property_value = Math.PI/4*(values)
      $("#tfa").val(property_value.toFixed(2));
    }
  });
  
  $(document.body).on("blur", ".nozzle_size" , function() {
        var max=[];
        var values = 0;
        var unit = document.getElementById('project_unit').value;
        $(".nozzle_size").each(function(){
          values += parseFloat(Math.pow($(this).val(),2));
    });
    if (unit == 'API'){
      var property_value = Math.PI/4096*(values)
      $("#tfa").val(property_value.toFixed(2));
    }
    else{
      var property_value = Math.PI/4*(values)
      $("#tfa").val(property_value.toFixed(2));
    }
  
       });


  var storedArray = JSON.parse(sessionStorage.getItem("items"));
  var well_id='{{well_id}}'
  if(well_id == storedArray[1]){
      $('.warning').show();
  }else{
      $('.warning').hide();
  }
    $( document ).ready(function() {
      var max=[];
      var values = 0;
      $(".nozzle_size").each(function(){
        values += parseFloat(Math.pow($(this).val(),2));
      });
      var property_value = Math.PI/4096*(values)
      $("#tfa").val(property_value.toFixed(2));
    });
  $("#drillbitform").validate({
      rules: {
          bit_type:"required",
          no_of_nozzle:"required",
          nozzle_size:"required",
       
      },
      messages: {
          bit_type:"Please select the Bit Type",
          no_of_nozzle:"Please enter the Number of Nozzle",
          nozzle_size:"Please enter the Nozzle Size",
        
      }
    });
    
    // $("#no_of_nozzle").change(function () {
    //   var a;
    //   a = document.getElementById('no_of_nozzle').value;
    //   var rowCounts = $('#drillbittable >tbody >tr').length;

    //   var uppendrow= a-(rowCounts-1)
    //   var rows = "";
    //   if(uppendrow >=0){
    //     for (var i = 0; i < uppendrow; i++) {
    //       var n=i+1;
    //       rows += '<tr><td> <input type="number" step="any" id="nozzle_size" class="form-control nozzle_size" name="nozzle_size"></td></tr>';
    //     }
    //     $("#drillbittable").append(rows);
    //   }
    //   else{
    //     for (var i = uppendrow; i <0; i++) {
    //       $("#drillbittable tr:last").remove();
    //     }
    //   }
    //   var max=[];
    //   var values = 0;
    //   $(".nozzle_size").each(function(){
    //     values += parseFloat(Math.pow($(this).val(),2));
    //   });
    //   var property_value = Math.PI/4096*(values)
    //   $("#tfa").val(property_value.toFixed(2));
    //   })
  
    //   $(document).on("blur", ".nozzle_size" , function() {
    //     var max=[];
    //     var values = 0;
    //     $(".nozzle_size").each(function(){
    //       values += parseFloat(Math.pow($(this).val(),2));
    // });
    // var property_value = Math.PI/4096*(values)
    // $("#tfa").val(property_value.toFixed(2));
  
    //    });
  
  var validate = function(e) {
  var t = e.value;
  e.value = (t.indexOf(".") >= 0) ? (t.substr(0, t.indexOf(".")) + t.substr(t.indexOf("."), 3)) : t;
  }
  </script>
<style>
  .iconaction
{
border:0;
background:transparent;
box-shadow:none;
font-size:15px;
color:#7367F0;
}
</style>
{% endblock %}
{% block scripts %}
{{block.super}}
<script src="{% static 'js/menuactive.js' %}"></script>
<script src="{% static 'js/allvalidation.js' %}"></script>

{%endblock%}
      

