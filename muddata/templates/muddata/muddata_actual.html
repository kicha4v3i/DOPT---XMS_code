{% extends "base.html" %}
{% block content %}
{% load static %}
{% load app_filters %}
<div class="row align-items-start">
  {% getcountries countries as countries %}
  {% include 'projectsidemenu.html' %} 
  <div class="col-md-8 p-0  create-pg main-section col-md-10"> 
    <div class="create_project_sec scroll-line new-cru-well">
      {% comment %} <div class="well-name-list">{{well.name}}</div>
      <button class="hide-show fa fa-long-arrow-right"></button> {% endcomment %}

    {% include "projectheader.html" %}
    
        <div class="col-12">
            {% include "welldetails_menu.html" %} 
        </div>
        <div class="col-12">
            <div class="sample-sub-menu">
              <div class="container">
                 <div class="row menu-button menu-types menu_lists">
                    <div class="col-md-3">
                        <div class="sub-list {% if request.session.submenu == 'muddata' %}active{% endif %}">
                            <a href="{% url 'muddata:muddatarheogramlist' wellphase_id %}" id="mud"> Mud Data </a>
                        </div>
                      </div>
                      <div class="col-md-3 data-drill">
                        <div class="sub-list drill-data2 {% if request.session.submenu == 'bhadata' %}active{% endif %}">
                            <a href="{% url 'bhadata:bhadatalist' wellphase_id %}" id="bhadata"> BHA Data</a>
                        </div>
                      </div>
                    <div class="col-md-3 data-drill">
                        <div class="sub-list drill-data {% if request.session.submenu == 'drillbit' %}active{% endif %}">
                            <a href="{% url 'drillbitdata:drillbitlist' wellphase_id %}" id="drillbit"> Drill Bit Data</a>
                        </div>
                    </div>
                 </div>
              </div>
            </div>
        </div>
        <div class="col-12 p-0">
            {% if muddatacount == 0 %}
            <div class="space-left-side">
                <a class="btn btn-primary detail-button" href="{% url 'muddata:importmuddata' wellphase_id %}"><span class="action-create-well"><i class="feather "></i>Import</span></a>
                <a class="btn btn-primary add_column_muddata detail-button"><span class="action-create-well ad-col-nme">Add Column</span></a>
                <a class="btn btn-primary remove_column_muddata detail-button"><span class="action-create-well ad-col-nme">Remove Column</span></a>
                </div>

                <form class="form form-horizontal" method="POST" id="muddataform" action="{% url 'muddata:create' wellphase_id %}">
                    {% csrf_token %}
                    <input type="hidden" id="well" class="form-control" name="well" value={{well_id}}>
                    <input type="hidden" name="well_phase" id="well_phases">
                    <input type="hidden" class="page_type" value="create">
                    <div class="row">
                    <div class="col-12">
                      <div class="scroll-bar-mud">

                        <table class="table mud-edit tbl-outer-space" id="muddata-table">
                            <thead>
                            <tr>
                                <th></th>
                                <th></th>
                                <th></th>
                        <th colspan="2" class="txt-col down-line text-center">Depth</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th colspan="3" class="txt-col down-line text-center">Gel Strength</th>
                        <th></th>
                        <th class="txt-col"></th>
                        <!-- <th>Date Recorded </th> -->
                        <th></th>
                        <th></th>

                            </tr>
                            </thead>
                            <thead>
                                <tr>
                                    <!-- <th class="txt-col">Date</th>
                                    <th class="txt-col">Time</th> -->
                                    <th class="txt-col">Depth</th>
                                    <th class="txt-col">MW{%display_densityunit request.session.unit%}</th>
                                    <th class="txt-col">Mud Type</th>
                                    <th class="txt-col">PV{%display_plastic_viscosity request.session.unit%}</th>
                                    <th class="txt-col">YP{%display_gelstrengthunit request.session.unit%}</th>
                                    <th class="txt-col">LSRYP{%display_gelstrengthunit request.session.unit%}</th>
                                    <th class="txt-col-sub">0sec{%display_gelstrengthunit request.session.unit%}</th>
                                    <th class="txt-col-sub ">10min {%display_gelstrengthunit request.session.unit%}</th>
                                    <th class="txt-col-sub ">30min {%display_gelstrengthunit request.session.unit%}</th>
                                    <th class="txt-col-sub "><input type="number" step="any" class="form-control rpm_parameter" name="rpm_parameter" value="3"></th>
                                    <th class="txt-col-sub "><input type="number" step="any" class="form-control rpm_parameter" name="rpm_parameter" value="6"></th>
                                    <th class="txt-col-sub "><input type="number" step="any" class="form-control rpm_parameter" name="rpm_parameter" value="100"></th>
                                    <th class="txt-col-sub "><input type="number" step="any" class="form-control rpm_parameter" name="rpm_parameter" value="200"></th>
                                    <th class="txt-col-sub "><input type="number" step="any" class="form-control rpm_parameter" name="rpm_parameter" value="300"></th>
                                    <th class="txt-col-sub "><input type="number" step="any" class="form-control rpm_parameter" name="rpm_parameter" value="600"></th>
                                    <th class="txt-col">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <!-- <td style="width: 10%;">
                                        <input type="text" class="form-control muddata_date" name="muddata_date">
                                    </td>
                                    <td style="width: 7%;">
                                        <input type="text" class="form-control muddata_time" name="muddata_time">
                                    </td> -->
                                    <td style="width: 12%;" class="inp-width">
                                        <input type="text" class="form-control depth" name="depth" placeholder="Depth"><span class="depth_error"></span>
                                    </td>
                                    <td style="width:5px;">
                                        <input type="number" step="any" class="form-control mud_weight" name="mud_weight" placeholder="MW"><span class="mud_weight_error"></span>
                                    </td>
                                    <td style="width: 8%;" class="inp-width">
                                        <select name="mudtype" class="form-control mudtype">
                                        <option value="">Select</option>
                                        {% for type in mudtype %}
                                        <option value="{{type.id}}">{{type.mud_name}}</option>
                                        {% endfor %}
                                        </select>
                                        <span class="mudtype_error"></span>
                                    </td>
                                    <td style="width:5%;">
                                        <input type="number" step="any" class="form-control plastic_viscosity" name="plastic_viscosity" placeholder="Plastic Viscosity"><span class="pv_error"></span>
                                    </td>
                                    <td class="inp-width">
                                        <input type="number" step="any" class="form-control yield_point" name="yield_point" placeholder="Yield Point"><span class="yp_error"></span>
                                    </td>
                                    <td class="inp-width">
                                        <input type="number" step="any" class="form-control low_shear_rate" name="low_shear_rate" placeholder="Low Shear Rate Yield Point"><span class="lsryp_error"></span>
                                    </td>
                                    <td class="inp-width">
                                        <input type="number" step="any" class="form-control gel_strength_0sec" name="gel_strength_0sec" placeholder="Gel Strength 0sec">
                                    </td>
                                    <td class="inp-width">
                                        <input type="number" step="any" class="form-control gel_strength_10min" name="gel_strength_10min" placeholder="Gel Strength 10min">
                                    </td>
                                    <td class="inp-width">
                                        <input type="number" step="any" class="form-control gel_strength_30min" name="gel_strength_30min" placeholder="Gel Strength 30min">
                                    </td>
                                    <td class="inp-width">
                                      <input type="number" step="any" class="form-control dial" name="dial_3" >
                                    </td>
                                    <td class="inp-width">
                                        <input type="number" step="any" class="form-control dial" name="dial_6" >
                                    </td>
                                    <td class="inp-width">
                                        <input type="number" step="any" class="form-control dial" name="dial_100" >
                                    </td>
                                    <td class="inp-width">
                                        <input type="number" step="any" class="form-control dial" name="dial_200" >
                                    </td>
                                    <td class="inp-width">
                                        <input type="number" step="any" class="form-control dial" name="dial_300" >
                                    </td>
                                    <td class="inp-width">
                                        <input type="number" step="any" class="form-control dial" name="dial_600" >
                                    </td>

                                    <td class="stri-row-btn">
                                        <button type="button" name="add" class="addmuddatarow iconaction" wellphase-id="{{wellphase_id}}"><i class="fa fa-plus"></i></button>
                                        <button type="button" name="remove" class="deletemuddatarow iconaction"><i class="fa fa-trash"></i></button>
                                    </td>
                                </tr>
                            </tbody>  
                        </table>
                    </div>
                    </div>
                    <div class="col-sm-9 offset-sm-3 but-side-space">
                        <button type="submit" class="btn btn-primary mr-1 waves-effect waves-float waves-light detail-button Actual_muddata_submit">Submit</button>
                        <a class="btn btn-primary pull-right detail-button" href="{{request.META.HTTP_REFERER}}">Go Back</a>  
                    </div>
                </div>
            </form>
            {%else%}
            <div class="table_wrapper table-scroll">
            <table class="table muddata-data-list-view mud-values">
                <thead>
                    <tr>
                        <th></th>
                        <th colspan="2" class="txt-col down-line text-center">Depth</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th colspan="3" class="txt-col down-line text-center">Gel Strength</th>
                    </tr>
                </thead>
                <thead>
                    <tr>
                        
                        <th class="txt-col-sub text-center">Depth</th>
                        <th class="txt-col text-center">MW </th>
                        <th class="txt-col text-center">Mud Type</th>
                        <th class="txt-col text-center">PV</th>
                        <th class="txt-col text-center">YP </th>
                        <th class="txt-col text-center">LSRYP </th>
                        <th class="txt-col-sub text-center"> 0sec </th>
                        <!-- <th>Date Recorded </th> -->
                        <th class="txt-col-sub text-center"> 10min </th>
                        <th class="txt-col-sub text-center"> 30min </th>
                        {% for rheodata in rheogram %}
                          <th class="txt-col-sub ">{{rheodata.rpm}}</th>
                        {%endfor%}
                      

                    </tr>
                </thead>
                <tbody class="mud-detail md-center">
                    {% for mud in muddata %}
                        <tr>
                          <td> {{mud.todepth}}</td>
                          <td class="text-center">{{mud.mud_weight}}</td>
                          <td class="text-center">{{mud.mudtype.mud_name}}</td>
                          <td class="text-center">{{mud.plastic_viscosity}}</td>
                          <td class="text-center">{{mud.yield_point}}</td>
                          <td class="text-center">{{mud.low_shear_rate}}</td>
                          <td class="text-center">{{mud.gel_strength_0sec}}</td>
                          <td class="text-center">{{mud.gel_strength_10min}}</td>
                          <td class="text-center">{{mud.gel_strength_30min}}</td> 
                          {% for rheodata in rheogram %}
                            {% with rheodata|getrheogramdata_actual:mud as rheo_data %}
                              <td class="text-center">{{rheo_data.dial}}</th>
                            {%endwith%}
                          {%endfor%}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>


            <nav aria-label="Page navigation example">
              <ul class="pagination justify-content-center">
              {% if muddata.has_previous %}
                  <li class="page-item">
                  <a class="page-link" href="?page={{ muddata.previous_page_number }}">Previous</a>
                </li>
              {% else %}
                  <li class="page-item disabled">
                  <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Previous</a>
                </li>
              {% endif %}

              {% if muddata.number|add:'-4' > 1 %}
                  <li class="page-item"><a class="page-link" href="?page={{ muddata.number|add:'-5' }}">&hellip;</a></li>
              {% endif %}

              {% for i in muddata.paginator.page_range %}
                  {% if muddata.number == i %}
                      <li class="page-item active" aria-current="page">
                    <span class="page-link">
                      {{ i }}
                      <span class="sr-only">(current)</span>
                    </span>
                  </li>
                  {% elif i > muddata.number|add:'-5' and i < muddata.number|add:'5' %}
                      <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                  {% endif %}
              {% endfor %}

              {% if muddata.paginator.num_pages > muddata.number|add:'4' %}
                <li class="page-item"><a class="page-link" href="?page={{ muddata.number|add:'5' }}">&hellip;</a></li>
              {% endif %}

              {% if muddata.has_next %}
                  <li class="page-item">
                  <a class="page-link" href="?page={{ muddata.next_page_number }}">Next</a>
                </li>
              {% else %}
                  <li class="page-item disabled">
                  <a class="page-link" href="#" tabindex="-1" aria-disabled="True">Next</a>
                </li>
              {% endif %}
            </ul>
            </nav>





            </div>
            <div class="col-sm-9 offset-sm-3 but-side-space">
                <a class="btn btn-primary pull-right detail-button" href="{{request.META.HTTP_REFERER}}">Go Back</a>  
                <a class="btn btn-primary detail-button" href="{% url 'muddata:edit' wellphase_id %}">Edit</a>  
                <a onclick="confirmation(event)" class="btn btn-primary detail-button" href="{% url 'muddata:delete' wellphase_id %}">Delete</a>  
            </div>
            
        {%endif%}

    </div>
    {% include "footer.html" %}
</div>
</div>

<div class="col-2">
  {% include "userheader.html" %}
  <h4 class="model-caption">Well Phases</h4>
  {% for wellphase in wellphases %}
            <div class="row">
              <div class="col-12">
                <nav class="navbar bg-white phase-sidemenu">
                  <ul class="nav navbar-nav">
                    <li class="nav-item phs-list {% if request.session.wellphasetab == wellphase.id %}active{% endif %}">
                      <a class="nav-link" href="{% url 'muddata:getwellphasemenubyid' wellphase.id %}"> {{wellphase.phase_name}}</a>
                      {% if well.well_type == 'Plan'%}
                      <ul class="myDIV nav navbar-nav custom_active_list pressure-sidemenu  {% if wellphase_id == wellphase.id %}show{% endif %}">
                        {% getsectionbywellphase_id wellphase.id as sections %}
                        {% for section in sections %}
      
                        <li data-id="{{section.section_name}}" wellphase_id="{{wellphase.id}}" class="wellphase_sidemenu remove-line">{{section.section_name | depthunit:request.session.unit}}</li>
                        {% endfor %}
                    </ul>
                    {%endif%}
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          {% endfor %}
    <h4 class="model-caption">Phase Depth</h4>
    <table>
      <tr>
        <td>
          <span class="font-weight-bold sta-col">From</span>
        </td>
        <td>
          {{fromdepth}}{%display_lengthunit request.session.unit%}
        </td>
      </tr>
      <tr>
        <td>
          <span class="font-weight-bold sta-col">To</span>
        </td>
        <td>
          {{todepth}}{%display_lengthunit request.session.unit%}
        </td>
      </tr>
    </table>
    <div class="col-md-12 warning"></div>
    <div class="col-md-12 alert_message">From depth is not greater than To depth</div>
    </div>
</div>

<style>
  .down-line {
    border-bottom: 2px solid #dadada !important;
}
</style>

<script src="{% static 'vendors/js/vendors.min.js' %}"></script>
<script>
  $(function() {
    $(document).on("keyup", ".dial" , function() {
      var closesttable=$(this).closest('table').attr('id');
      var tabletype = closesttable.split("-")[0];
      var dial=[];
      var rpm=[];
      var wellphase_id="{{wellphase_id}}"
      var well_id='{{well_id}}'
      if(tabletype=="rheogram"){
        var section_name=$(this).closest('table').attr('data-id')
        $('#'+closesttable+ " .dial").each(function(){
          var closestrpm=$(this).closest('td').prev('td').find('.rpm').val();
          if($(this).val()!=''){
            rpm.push(closestrpm);
            dial.push($(this).val())
          }
        })
        $.ajax({
        type: "GET",
        url:"/wells/muddata/getdirectchart",
        data:{
          wellphase_id:wellphase_id,
          rpm:rpm,
          dial:dial,
          section_name:section_name,
          well_id:well_id
        },
        success: function(data) {
          console.log(data)
          dynamicdirectchart(data,section_name)
        }

        
      });
      }


    });
    var directchart
    function dynamicdirectchart(data,containerid){
      directchart = Highcharts.chart(containerid+'-dynamicdirectchart', {
        chart: {
            //type: 'spline',
            // zoomType: 'xy'
            reflow: false,

        },
        title: {
            text: 'Shear Rate(dial) Line Fit Plot'
        },
        credits: {
          enabled: false
        },
        // subtitle: {
        //     text: 'Source: Heinz  2003'
        // },
        xAxis: {
            title: {
                enabled: true,
                text: 'RPM'
            },
            tickInterval : 100 ,

        },
        yAxis: {
            title: {
                text: 'Dial'
            },
            tickInterval : 20,

        },
        legend: {
            // layout: 'vertical',
            // align: 'left',
            // verticalAlign: 'top',
            // x: 100,
            // y: 70,
            // floating: true,
            // backgroundColor: Highcharts.defaultOptions.chart.backgroundColor,
            // borderWidth: 1
            
        },
        plotOptions: {
            scatter: {
                marker: {
                    radius: 5,
                    states: {
                        hover: {
                            enabled: true,
                            lineColor: 'rgb(100,100,100)'
                        }
                    }
                },
                states: {
                    hover: {
                        marker: {
                            enabled: false
                        }
                    }
                },
                tooltip: {
                    headerFormat: '<b>{series.name}</b><br>',
                    // pointFormat: '{point.x} cm, {point.y} kg'
                }
            },
            dataLabels: {
                    style: {
                      fontSize: "100px"
            }
            
        }
        },
        
        series: [
        {
            type:'scatter',
            name: 'Shear Stress(dial)',
            color: '#0000ff',
            data: data.userdial,
            dashStyle: 'LongDashDot'
        }, 
        {
            type: 'spline',
            name: 'Newtonian',
            color: 'rgb(22,96,178)',
            data: data.newtoniondial,
            dashStyle: 'Solid',
        },
        {
            type: 'spline',
            name: 'Bingham Plastic',
            color: '#2CB68B',
            data: data.binghammodal,
            dashStyle: 'Solid',
        },
        {
            type: 'spline',
            name: 'Powerlaw',
            color: '#298f8a',
            data: data.powerlawmodal,
            dashStyle: 'Solid',
        },
        {
            type: 'spline',
            name: '<b style="color:green">hershel</b>',
            color: 'rgb(245,173,43)',
            data: data.hershelmodal,
            dashStyle: 'Solid',
            
      }
      ]
    });
    }
    var storedArray = JSON.parse(sessionStorage.getItem("items"));
    var well_id='{{well_id}}'
    if(well_id == storedArray[1]){
      $('.warning').show();
    }else{
      $('.warning').hide();
    }
    $('.modal-tables').hide();
  });
  $(document).on("click",".nav-link" , function() { 
  $(".modalselect").change(function () {
  var selected_model = $(this).val();
  var wellphase_id="{{wellphase_id}}";
  var section_name=$(this).attr('data-id');
  $.ajax({ 
    type: "GET",                      
    url: "/wells/muddata/modelselected",                    
    data: {
      wellphase_id:wellphase_id,
      selected_model:selected_model,
      section_name:section_name
    },
    dataType: "json",
    success: function (data) { 
      $(".modalselect").val(selected_model);

    }
  });
})
  })
</script>
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/navigation.css' %}">

<style>
  a.nav-link.active {
    color: #3f8aca !important;
    border-bottom: 2px solid #428ccb !important;
  }

  a.remove-blue-line.active {
    border-bottom: none !important;
}
  .nav-tabs .nav-item .nav-link {
    border-radius: 0px !important;
  }

  .iconaction
  {
    border:0;
    background:transparent;
    box-shadow:none;
    font-size:15px;
    /* color:#7367F0; */
    color:#7c0201;
  }
  </style>
{% endblock %}
{% block scripts %}
{{block.super}}
<script>
  var well_id=$('#well').val()
</script>
<script src="{% static 'js/optimization.js' %}"></script>
<script src="{% static 'js/muddata.js' %}"></script>

<script src="{% static 'js/menuactive.js' %}"></script>
<script src="{% static 'js/allvalidation.js' %}"></script>
{%endblock%}
