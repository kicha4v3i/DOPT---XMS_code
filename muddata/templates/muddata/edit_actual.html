
{% extends "base.html" %}
{% block content %}
{% load static %}
{% load app_filters %}

<section>
  <div class="row align-items-start">
    {% getcountries countries as countries %}
    {% include 'projectsidemenu.html' %} 
  <div class="col-md-8 p-0  create-pg main-section col-md-10">
    <div class="create_project_sec scroll-line new-cru-well">
      {% comment %} <div class="well-name-list">{{well.name}}</div>
      <button class="hide-show fa fa-long-arrow-right"></button> {% endcomment %}
      {% include "projectheader.html" %}
      <div class="col-12">
          {% include "welldetails_menu.html" %} 
      </div>
      <div class="col-12">
        <div class="sample-sub-menu">
          <div class="container">
            <div class="row menu-button menu-types menu_lists">
                <div class="col-md-3">
                    <div class="sub-list {% if request.session.submenu == 'muddata' %}active{% endif %}">
                        <a href="{% url 'muddata:muddatarheogramlist' wellphase_id %}" id="mud"> Mud Data </a>
                    </div>
                </div>
                <div class="col-md-3 data-drill">
                  <div class="sub-list drill-data2 {% if request.session.submenu == 'bhadata' %}active{% endif %}">
                      <a href="{% url 'bhadata:bhadatalist' wellphase_id %}" id="bhadata"> BHA Data</a>
                  </div>
                </div>
                <div class="col-md-3 data-drill">
                    <div class="sub-list drill-data {% if request.session.submenu == 'drillbit' %}active{% endif %}">
                        <a href="{% url 'drillbitdata:drillbitlist' wellphase_id %}" id="drillbit"> Drill Bit Data</a>
                    </div>
                </div>

            </div>
          </div>
        </div>
      </div>
      <div class="col-12">
        <a class="btn btn-primary add_column_muddata detail-button"><span class="action-create-well">Add Column</span></a>
        <a class="btn btn-primary remove_column_muddata detail-button"><span class="action-create-well">Remove Column</span></a>
        <form class="form form-horizontal" method="POST" id="muddataform">
          {% csrf_token %}
          <input type="hidden" id="well" class="form-control" name="well" value={{well_id}}>
          <input type="hidden" name="well_phase" id="well_phases">
          <input type="hidden" class="page_type" value="edit">
          <div class="col-12 table-scroll">
            <table class="table border-rem tbl-outer-space" id="muddata-table">
              <thead>  
                <tr>
                  <th></th>
                  <th colspan="1" class="txt-col down-line text-center">Depth</th>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th colspan="3" class="txt-col down-line text-center">Gel Strength</th>
                  <th></th>
                  <th></th>
                  <th class="txt-col"></th>
                  <th></th>
                  <th></th>
                  <!-- <th>Date Recorded </th> -->
               
                </tr>
              </thead>
              <thead>
                <tr>
                  <!-- <th class="txt-col">Date</th>
                  <th class="txt-col">Time</th> -->
                  <th class="txt-col">Depth</th>
                  <th class="txt-col">MW{%display_densityunit request.session.unit%}</th>
                  <th class="txt-col">Mud Type</th>
                  <th class="txt-col">PV{%display_plastic_viscosity request.session.unit%}</th>
                  <th class="txt-col">YP{%display_gelstrengthunit request.session.unit%}</th>
                  <th class="txt-col">LSRYP{%display_gelstrengthunit request.session.unit%}</th>
                  <th class="txt-col"> 0sec{%display_gelstrengthunit request.session.unit%}</th>
                  <th class="txt-col"> 10min{%display_gelstrengthunit request.session.unit%} </th>
                  <th class="txt-col"> 30min {%display_gelstrengthunit request.session.unit%}</th>
                  {% for rheodata in rheogram %}
                    <th class="txt-col-sub "><input type="number" step="any" class="form-control rpm_parameter" name="rpm_parameter" value="{{rheodata.rpm}}"></th>
                  {%endfor%}
                  <th class="txt-col">Action</th>
                </tr>
              </thead>
              <tbody class="mud-detail-edit">
                {% for section in sections %}                       
                <tr>
                  <input type="hidden" name="selected_model" value="{{section.selected_model}}">
                  <input type="hidden" name="section_id" value="{{section.id}}" class="section_id">
                  <input type="hidden" name="muddata_id" value="{{section|getmuddata:'id'}}" class="muddata_id">

                  <!-- <td style="width:15%;">
                    <input type="text" class="form-control muddata_date" name="muddata_date" value="{{section.date|date:'d-m-Y'}}">
                  </td>
                  <td style="width:8%;">
                    <input type="text" class="form-control muddata_time" name="muddata_time" value="{{section.time|time:'h:i'}}">
                  </td> -->
                  <td style="width:10%;">
                    <input type="number" step="any" class="form-control depth" name="depth" placeholder="Depth" value="{{section.todepth}}"><span class="depth_error"></span>
                  </td>
                  <td style="width:8%;">
                    <input type="number" step="any" class="form-control mud_weight" name="mud_weight" placeholder="MW" value="{{section|getmuddata:'mud_weight'}}"><span class="mud_weight_error"></span>
                  </td>
                  <td style="width:8%;" class="new-one1">
                    <select name="mudtype" class="form-control mudtype">
                      <option value="">Select</option>
                      {% for type in mudtype %}
                      <option value="{{type.id}}" {% if type.id == section|getmuddata:'mudtype_id' %} selected {% endif %}>{{type.mud_name}}</option>
                      {% endfor %}
                    </select>
                    <span class="mudtype_error"></span>
                  </td>
                  <td style="width:8%;" class="new-one1">
                    <input type="number" step="any" class="form-control plastic_viscosity" name="plastic_viscosity" placeholder="PV" value="{{section|getmuddata:'plastic_viscosity'}}"><span class="pv_error"></span>
                  </td>
                  <td class="new-one1">
                    <input type="number" step="any" class="form-control yield_point" name="yield_point" placeholder="YP" value="{{section|getmuddata:'yield_point'}}"><span class="yp_error"></span>
                  </td>
                  <td class="new-one1">
                    <input type="number" step="any" class="form-control low_shear_rate" name="low_shear_rate" placeholder="LSRYP" value="{{section|getmuddata:'low_shear_rate'}}"> <span class="lsryp_error"></span>
                  </td>
                  <td>
                    <input type="number" step="any" class="form-control gel_strength_0sec" name="gel_strength_0sec" placeholder="0sec" value="{{section|getmuddata:'gel_strength_0sec'}}">
                  </td>
                  <td>
                    <input type="number" step="any" class="form-control gel_strength_10min" name="gel_strength_10min" placeholder="10min" value="{{section|getmuddata:'gel_strength_10min'}}">
                  </td>
                  <td>
                    <input type="number" step="any" class="form-control gel_strength_30min" name="gel_strength_30min" placeholder="30min" value="{{section|getmuddata:'gel_strength_30min'}}">
                  </td>
                  {% for rheodata in rheogram %}
                   {% with rheodata|getrheogramdata_actual:section as rheogramdata %}
                    <td><input type="number" step="any" class="form-control dial" name="dial_{{rheodata.rpm}}" value="{{rheogramdata.dial}}">
                    <input type="hidden" name="rheogram_id_{{rheodata.rpm}}" value="{{rheogramdata.id}}" class="rheogramid">
                    </td>
                  {%endwith%}
                  {%endfor%}
                  <td class="same-line-plusmins">
                    <button type="button" name="add" class="addmuddatarow iconaction re-button" wellphase-id="{{wellphase_id}}"><i class="fa fa-plus"></i></button>
                    <button type="button" name="remove" class="deletemuddatarow iconaction re-button"><i class="fa fa-trash"></i></button>
                  </td>
                </tr>
                {% endfor %}
              </tbody>  
            </table>
          </div>
          <div class="col-sm-9 offset-sm-3 mud-btn-spa">
            <button type="submit" class="btn btn-primary mr-1 waves-effect waves-float waves-light detail-button Actual_muddata_submit">Submit</button>
            <a class="btn btn-primary pull-right detail-button" href="{{request.META.HTTP_REFERER}}">Go Back</a>  
          </div>
        </form>
      </div>
      {% include "footer.html" %}
    </div>  
  </div>
  <div class="col-2">
    {% include "userheader.html" %}
    <div class="left-sidebar">
      <h4 class="model-caption">Well Phases</h4>
      {% for wellphase in wellphases %}
        <div class="row">
          <div class="col-12">
            <nav class="navbar bg-white phase-sidemenu">
              <ul class="nav navbar-nav">
                <li class="nav-item phs-list {% if request.session.wellphasetab == wellphase.id %}active{% endif %}">
                  <a class="nav-link" href="{% url 'muddata:getwellphasemenubyid' wellphase.id %}"> {{wellphase.phase_name}}</a>
                  <!-- <ul class="myDIV nav navbar-nav custom_active_list pressure-sidemenu  {% if wellphase_id == wellphase.id %}show{% endif %}">
                    {% getsectionbywellphase_id wellphase.id as sections %}
                    {% for section in sections %}

                    <li data-id="{{section.section_name}}" wellphase_id="{{wellphase.id}}" class="wellphase_sidemenu remove-line">{{section.section_name | depthunit:request.session.unit}}</li>
                    {% endfor %}
                </ul> -->
                </li>
              </ul>
            </nav>
          </div>
        </div>
      {% endfor %}
      <h4 class="model-caption">Phase Depth</h4>
      <table>
        <tr>
          <td>
            <span class="font-weight-bold sta-col">From</span>
          </td>
          <td>
            {{fromdepth}}{%display_lengthunit request.session.unit%}
          </td>
        </tr>
        <tr>
          <td>
            <span class="font-weight-bold sta-col">To</span>
          </td>
          <td>
            {{todepth}}{%display_lengthunit request.session.unit%}
          </td>
        </tr>
      </table>
      <div class="col-md-12 warning"></div>
      <div class="col-md-12 alert_message">From depth is not greater than To depth</div>
    </div>
  </div>
</div>
</div>
</section>
<style>
  a.nav-link.active {
    color: #3f8aca !important;
    border-bottom: 2px solid #428ccb !important;
    border-radius: 0px !important;
  }

  .nav-tabs .nav-item .nav-link {
    border-radius: 0px !important;
}


  .environment-fields,.sub-environment-fields
  {
    display: none;
  }
  </style>
  
  <script src="{% static 'vendors/js/vendors.min.js' %}"></script>
  <script src="{% static 'vendors/js/forms/validation/jquery.validate.min.js' %}"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
       $("#basicDate").flatpickr({
      enableTime: true,
      dateFormat: "Y-m-d"
  });
  var storedArray = JSON.parse(sessionStorage.getItem("items"));
    var well_id='{{well_id}}'
    if(well_id == storedArray[1]){
      $('.warning').show();
    }else{
      $('.warning').hide();
    }
  // $("#muddataeditform").validate({
  //   rules: {
  //     gel_strength_0sec:"required",
  //     gel_strength_10min:"required",
  //     gel_strength_30min:"required",
  //     mud_weight:"required",
  //     date:"required",
  //   },
  //   messages: {
  //     gel_strength_0sec:"Please enter Gel Strength 0sec",
  //     gel_strength_10min:"please enter gel_strength_0sec",
  //     gel_strength_30min:"Please enter gel_strength_30min",
  //     mud_weight:"Please enter mud_weight",
  //     date:"Please enter date",
  //   }
  // });
    
    </script>
  
{% endblock %}
{% block scripts %}
{{block.super}}
<script>
    var imgsrc="{% static 'images/loading-81.gif' %}"
</script>
<script src="{% static 'js/sensitivity.js' %}"></script>
<script src="{% static 'js/muddata.js' %}"></script>

<script src="{% static 'js/menuactive.js' %}"></script>
<script src="{% static 'js/allvalidation.js' %}"></script>
{%endblock%}
      

